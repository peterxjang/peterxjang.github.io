<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sending POST requests in Rails 5.1 without jQuery</title>
    <meta name="description" content="Since the jQuery library was removed as a hard dependency in Rails 5.1, it’s a little harder to send AJAX requests from JavaScript. jQuery…">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Peter Jang">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="Peter Jang">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Peter Jang</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Blog</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>Sending POST requests in Rails 5.1 without jQuery</h1>

<p>Since the jQuery library was removed as a hard dependency in Rails 5.1, it’s a little harder to send AJAX requests from JavaScript. jQuery made it easy for a couple of reasons. One, it provided helper functions like <code>$.get</code>, <code>$.post</code>, and the more general<code>$.ajax</code>. Two, it automatically included the CSRF token in the header of the request. Without the CSRF token that Rails generates, Rails will by default reject any non-GET requests, even for same-origin requests.</p>
<p>Despite not having jQuery, Rails 5.1 actually does provide a way to send AJAX requests! Rails was able to drop the jQuery dependency simply by writing their own helper functions in vanilla JavaScript. These helpers are included in every new Rails app as <code>rails-ujs</code> (you can see the source <a href="https://github.com/rails/rails/tree/master/actionview/app/assets/javascripts">here</a>). This gives your JavaScript access to an object called <code>Rails</code> (as opposed to <code>$</code>). One of the helpers is <code>Rails.ajax</code>, which is very similar to jQuery’s <code>$.ajax</code>. Here is an example of a GET request:</p>
<pre class="language-javascript"><code class="language-javascript">Rails<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  url<span class="token operator">:</span> <span class="token string">"/api/v1/people.json"</span><span class="token punctuation">,</span><br>  type<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Easy enough, especially if you’re familiar with jQuery. (Note that this isn’t a 100% compatible drop in replacement for <code>$.ajax</code>, it was simply written to resemble the API of <code>$.ajax</code>). Here is an example of a POST request:</p>
<pre class="language-javascript"><code class="language-javascript">Rails<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  url<span class="token operator">:</span> <span class="token string">"/api/v1/people.json"</span><span class="token punctuation">,</span><br>  type<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span><br>  data<span class="token operator">:</span> <span class="token string">"first_name=Ricky&amp;last_name=Bobby"</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Two things to note about this POST request. One, it’s automatically sending the CSRF token, which means the request will go through without any additional configuration (nice!). Two, the <code>data</code> must be formatted as string form parameters, you can’t give it a JavaScript object, at least at the time of this writing with Rails 5.1.3 (not so nice!). Note that it should be trivial to set the <code>&quot;Content-Type&quot;</code> of the request to <code>&quot;application/json&quot;</code>, which would allow you to send a stringified JavaScript object, but it doesn’t seem to be possible with the way <code>rails-ujs</code> is written as of now.</p>
<p>If not being able to send POST data as JSON is a deal breaker, you can instead use other approaches like the new <code>fetch</code> API. In that case, you would be responsible for finding the CSRF token in the DOM and sending it with the request headers. There’s actually a helper function in <code>rails-ujs</code> that can grab the CSRF token — <code>Rails.csrfToken()</code>. Here’s the same POST request using the <code>fetch</code> API instead:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/api/v1/people.json"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  method<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span><br>  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    first_name<span class="token operator">:</span> <span class="token string">"Ricky"</span><span class="token punctuation">,</span><br>    last_name<span class="token operator">:</span> <span class="token string">"Bobby"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  headers<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span><br>    <span class="token string">"X-CSRF-Token"</span><span class="token operator">:</span> Rails<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  credentials<span class="token operator">:</span> <span class="token string">"same-origin"</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The advantage to this approach is that you can send POST data using any format you want, whether it’s JSON or string form parameters. The disadvantage is that <code>fetch</code> isn’t 100% compatible with every browser yet, and it’s a little harder for beginners to understand. In either case, be sure to take advantage of the <code>rails-ujs</code> helper functions in your JavaScript to send AJAX requests with ease!</p>


<hr>
<ul><li>Next: <a href="/blog/comparing-frontend-approaches-part-1-introduction.html">Comparing Frontend Approaches Part 1: Introduction</a></li><li>Previous: <a href="/blog/a-functional-canvas-approach-with-redux-part-2.html">A Functional Canvas Approach With Redux: Part 2</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/sending-post-requests-in-rails-51-without-jquery.html -->
  </body>
</html>
