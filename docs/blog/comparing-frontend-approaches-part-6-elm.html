<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparing Frontend Approaches Part 6: Elm</title>
    <meta name="description" content="A look at jQuery, Vue.js, React, and Elm">

    

    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="peterxjang">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="peterxjang">
  </head>
  <body>
    <header class="sticky">
      <ul class="nav">
      
        <li class="nav-item"><a href="/"><strong>peterxjang</strong></a></li>
        <li class="nav-item"><a href="/blog/">blog</a></li>
        <li class="nav-item" style="margin-left: auto">
          <a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/peterxjang" aria-label="Twitter">
            <svg class="nav-icon" viewBox="0 0 29 29"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg>
          </a>
        </li>
        <li class="nav-item"">
          <a target="_blank" rel="noopener noreferrer me" href="https://github.com/peterxjang" aria-label="GitHub">
            <svg class="nav-icon" viewBox="-8 -5 34 34"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>
          </a>
        </li>
        <li class="nav-item">
          <a target="_blank" rel="noopener noreferrer me" href="https://linkedin.com/in/peterxjang" aria-label="LinkedIn">
            <svg class="nav-icon" viewBox="0 0 29 29"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg>
          </a>
        </li>
      </ul>
    </header>

    <main class="tmpl-post">
      <div class="post-title">
  <h1>Comparing Frontend Approaches Part 6: Elm</h1>
  <time class="postlist-date" datetime="2017-09-26">26 Sep 2017</time>
</div>

<ul>
<li><a href="comparing-frontend-approaches-part-1-introduction.html">Part 1: Introduction</a></li>
<li><a href="comparing-frontend-approaches-part-2-jquery.html">Part 2: jQuery</a></li>
<li><a href="comparing-frontend-approaches-part-3-vuejs.html">Part 3: Vue.js</a></li>
<li><a href="comparing-frontend-approaches-part-4-vuejs-with-components.html">Part 4: Vue.js with components</a></li>
<li><a href="comparing-frontend-approaches-part-5-react.html">Part 5: React</a></li>
<li><strong>Part 6: Elm</strong></li>
<li><a href="comparing-frontend-approaches-part-7-final-thoughts.html">Part 7: Final thoughts</a></li>
</ul>
<p><img src="/img/1__NQppPMuv7xYB1IB4hF4AnQ.png#medium" alt="Elm logo"></p>
<p>In this part we will be implementing the <a href="comparing-frontend-approaches-part-1-introduction.html">web based clone</a> of the <a href="https://support.apple.com/kb/PH22608?locale=en_US">Mac Notes app</a> using <a href="http://elm-lang.org/">Elm</a>. Elm (which is not a JavaScript framework but a completely different language that compiles down to JavaScript) came out in 2012 and is currently gaining a lot of traction, with more and more companies <a href="https://github.com/lpil/elm-companies">using it in production</a>.</p>
<p>Elm is a statically typed purely functional language inspired by Haskell, but with a design that makes it easier for beginners to functional programming to get started. It uses a virtual DOM approach similar to React (even though the two were created independently). Elm doesn’t use a framework per se, but instead uses a pattern called <a href="https://guide.elm-lang.org/architecture/">The Elm Architecture</a>. Let’s dive in and check it out!</p>
<blockquote>
<p>Note — this article is not meant to teach Elm from scratch, but rather give an overview of what building an Elm app looks like in comparison to other JavaScript frontend approaches. You don’t need experience with the language to get something out of the article, but if you want a sense of the language before continuing, I would recommend reading this <a href="http://elm-lang.org/docs/from-javascript">Elm vs. JavaScript syntax comparison</a> and looking over the <a href="https://guide.elm-lang.org/">official guide</a> (which is an excellent resource for learning the language).</p>
</blockquote>
<h3 id="installation">Installation <a class="direct-link" href="#installation">#</a></h3>
<p>Like <a href="comparing-frontend-approaches-part-4-vuejs-with-components.html">Vue.js with components</a> and <a href="comparing-frontend-approaches-part-5-react.html">React</a>, we’re going to need a build process to use Elm. First we need to install Elm itself if you don’t already have it on your computer:</p>
<pre><code>$ npm install -g elm
</code></pre>
<p>Now we’re going to create a new directory and copy the HTML and CSS files from the original <a href="https://jsfiddle.net/peterxjang/vtsjc5w9/?utm_source=website&amp;utm_medium=embed&amp;utm_campaign=vtsjc5w9">notes app template</a>. The only thing left is the JavaScript, which we will generate from Elm code. First run the command:</p>
<pre><code>$ elm init
</code></pre>
<p>This will prompt you to create an <code>elm.json</code> file (which is similar to JavaScript’s <code>package.json</code> file). By default it included the necessary dependencies for Elm to work with a web browser.</p>
<p>Next we’re going to create a new file called <strong><code>Notes.elm</code></strong>, which will contain our Elm code. Right now we aren’t going to add any new functionality, we just want to convert the HTML template into Elm code, like we did with <a href="comparing-frontend-approaches-part-5-react.html">React</a> and JSX. However, Elm doesn’t use JSX — it uses plain old functions instead. Here’s what the <strong><code>Notes.elm</code></strong> file looks like:</p>
<pre class="language-elm"><code class="language-elm"><span class="token keyword">module</span> <span class="token constant">Notes</span> <span class="token keyword">exposing</span> <span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">)</span><br><br><span class="token import-statement"><span class="token keyword">import</span> Html <span class="token keyword">exposing</span> </span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">)</span><br><span class="token import-statement"><span class="token keyword">import</span> Html.Attributes <span class="token keyword">exposing</span> </span><span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">)</span><br><br><br><span class="token hvariable">main</span> <span class="token operator">=</span><br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">id</span> <span class="token string">"app"</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">[</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">[</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"New"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Delete"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">input</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-search"</span><span class="token punctuation">,</span> <span class="token hvariable">type_</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token hvariable">placeholder</span> <span class="token string">"Search..."</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>            <span class="token punctuation">]</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-container"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">[</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selectors"</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">[</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector active"</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-title"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"First note..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">,</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-timestamp"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">]</span><br>                <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector"</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-title"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Second note..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">,</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-timestamp"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">]</span><br>                <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector"</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-title"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Third note..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">,</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-timestamp"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span><br>                    <span class="token punctuation">]</span><br>                <span class="token punctuation">]</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor"</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-info"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">,</span> <span class="token hvariable">textarea</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-input"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"First note..."</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">]</span><br>            <span class="token punctuation">]</span><br>        <span class="token punctuation">]</span></code></pre>
<p>This is our first look at Elm code! Some notes:</p>
<ul>
<li>The first line is defining the code in this file as a module named <code>Notes</code>, which we will refer to later in the HTML.</li>
<li>The next two lines are importing functions from the <code>Html</code> library.</li>
<li>The next line <code>main =</code> is defining the main function. Functions in Elm do not have parentheses or keyword declarations, so they’re a bit hard to notice when coming from JavaScript.</li>
<li>The rest of the code is defining the HTML using functions like <code>div</code>, <code>button</code>, <code>p</code>, etc. Each of these functions take two arguments — a list of attributes and a list of child nodes. So for example, a simple <code>&lt;p&gt;</code> tag would look like <code>p [class &quot;info&quot;] [text &quot;Sample text&quot;]</code>. This app starts with the parent <code>div [ id &quot;app&quot; ] [ … ]</code>, and every other HTML element is a child node of this parent and are inside the second argument list (which is a bit hard to see here).</li>
<li>The <a href="http://elm-lang.org/docs/style-guide">convention in Elm</a> is to write multi-line lists with commas at the start of each line instead of at the end, which can be pretty jarring coming from languages like JavaScript. The good news is that you can install a tool called <a href="https://github.com/avh4/elm-format"><code>elm-format</code></a>, which can automatically format your Elm code (similar to <a href="https://golang.org/cmd/gofmt/"><code>gofmt</code></a> for Go and <a href="https://github.com/prettier/prettier"><code>prettier</code></a> for JavaScript). You can configure it to format your code every time you hit save in your editor, so you don’t need to worry about comma placement, indentation, or other style concerns!</li>
</ul>
<p>To compile the code, we need to run this command in the terminal:</p>
<pre><code>$ elm make Notes.elm --output js/notes.js
</code></pre>
<p>This will use the <code>elm make</code> command line tool to compile the Elm code in <strong><code>Notes.elm</code></strong> into a JavaScript file named <code>notes.js</code> in a folder named <code>js</code>. Note that it will also download the appropriate packages to a new folder called <code>elm-stuff</code> (similar to Node’s <code>node_modules</code> folder).</p>
<p>The last step is to edit the <strong><code>index.html</code></strong> file by removing all the HTML elements that now live in the Elm code and adding code to load up the Elm library:</p>
<pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Notes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>css/notes.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>link</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/notes.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span><br><ins class="highlight-line highlight-line-add">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></ins><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br><ins class="highlight-line highlight-line-add">      <span class="token keyword">var</span> app <span class="token operator">=</span> Elm<span class="token punctuation">.</span>Notes<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></ins><br><ins class="highlight-line highlight-line-add">        <span class="token literal-property property">node</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></ins><br><ins class="highlight-line highlight-line-add">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span></code></pre>
<p>Open the <strong><code>index.html</code></strong> file in your browser and you should see the familiar notes app starting point! You can see the code so far <a href="https://github.com/peterxjang/notes-app-elm/tree/7913b8708a09c4482b307cd9bb47ae8f3f6ed8c3">here</a> for reference.</p>
<h3 id="display-note-titles-from-an-array-of-notes">Display note titles from an array of notes <a class="direct-link" href="#display-note-titles-from-an-array-of-notes">#</a></h3>
<p>Now we can start to make the HTML more dynamic by storing notes as a list (think JS array) of records (think JS objects) and looping through them to generate note selectors. We will do this by structuring the code using <a href="https://guide.elm-lang.org/architecture">The Elm Architecture</a>, which essentially boils down to defining 4 functions that Elm wires together to create the app.</p>
<p>First let’s look at the main function itself. Here we’re using the <code>Browser.element</code> function that does all the work of wiring up our app. All we need to do is define each of the 4 functions — init, view, update, and subscriptions.</p>
<pre class="language-elm"><code class="language-elm"><span class="token hvariable">main</span> <span class="token operator">=</span><br>    <span class="token hvariable">Browser.element</span><br>        <span class="token punctuation">{</span> <span class="token hvariable">init</span> <span class="token operator">=</span> <span class="token hvariable">init</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">view</span> <span class="token operator">=</span> <span class="token hvariable">view</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">update</span> <span class="token operator">=</span> <span class="token hvariable">update</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">subscriptions</span> <span class="token operator">=</span> <span class="token hvariable">subscriptions</span><br>        <span class="token punctuation">}</span></code></pre>
<p>Before we look at the 4 functions, let’s first look at how we’re defining the model, which is the data we’re using in our app (think <code>state</code> in React or <code>data</code> in Vue.js). Elm is a statically typed language, so we are defining the types on all the data up front. An individual Note type is defined with the line <code>type alias Note = { id : Int, body : String, timestamp : Int }</code>, which means a note must be a record with an integer id, string body, and integer timestamp. Now we define the <code>Model</code> itself with the line <code>type alias Model = { notes : List Note }</code>. This is saying that the <code>Model</code> must be a record with a key of <code>notes</code> and a value of a list of <code>Note</code> records. Defining these static types up front can seem like extra work, but they help prevent runtime errors later (if you forget to add a timestamp to a new note, etc.).</p>
<pre class="language-elm"><code class="language-elm"><span class="token comment">-- MODEL</span><br><br><span class="token keyword">type</span> <span class="token keyword">alias</span> <span class="token constant">Note</span> <span class="token operator">=</span><br>    <span class="token punctuation">{</span> <span class="token hvariable">id</span> <span class="token operator">:</span> <span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token hvariable">body</span> <span class="token operator">:</span> <span class="token constant">String</span><span class="token punctuation">,</span> <span class="token hvariable">timestamp</span> <span class="token operator">:</span> <span class="token constant">Int</span> <span class="token punctuation">}</span><br><br><br><span class="token keyword">type</span> <span class="token keyword">alias</span> <span class="token constant">Model</span> <span class="token operator">=</span><br>    <span class="token punctuation">{</span> <span class="token hvariable">notes</span> <span class="token operator">:</span> <span class="token constant">List</span> <span class="token constant">Note</span> <span class="token punctuation">}</span></code></pre>
<p>Now let’s take a look at the <code>init</code> function, which initializes the model. The <code>init</code> function itself has a type annotation of <code>init : () -&gt; ( Model, Cmd Msg )</code>, which means it must return a <code>Model</code> and a <code>Cmd</code> (command). Commands are how Elm handles side effects, which is a significant departure from the world of JavaScript. Elm is a pure functional language, which means functions aren’t allowed to have side effects, so you need different mechanisms to handle them. As of this moment, the init function doesn’t have any need for side effects so we’re outputting no command with <code>Cmd.none</code>. Also note that I’m leaving the timestamps as 0 for now — we need some sort of Elm equivalent to JavaScript’s <code>Date.now()</code>. But if you consider it closely, getting the current time is an impure function with side effects! Which means we actually will need a command in the <code>init</code> function, which we’ll wire up in a bit...</p>
<pre class="language-elm"><code class="language-elm"><span class="token hvariable">init</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span> <span class="token constant">Model</span><span class="token punctuation">,</span> <span class="token constant">Cmd</span> <span class="token constant">Msg</span> <span class="token punctuation">)</span><br><span class="token hvariable">init</span> _ <span class="token operator">=</span><br>    <span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token hvariable">notes</span> <span class="token operator">=</span><br>            <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token hvariable">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token hvariable">body</span> <span class="token operator">=</span> <span class="token string">"First note..."</span><span class="token punctuation">,</span> <span class="token hvariable">timestamp</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><br>            <span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token hvariable">id</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token hvariable">body</span> <span class="token operator">=</span> <span class="token string">"Second note..."</span><span class="token punctuation">,</span> <span class="token hvariable">timestamp</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><br>            <span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token hvariable">id</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token hvariable">body</span> <span class="token operator">=</span> <span class="token string">"Third note..."</span><span class="token punctuation">,</span> <span class="token hvariable">timestamp</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><br>            <span class="token punctuation">]</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">,</span> <span class="token hvariable">Cmd.none</span><br>    <span class="token punctuation">)</span></code></pre>
<p>The next function is the <code>update</code> function, which defines how the model gets updated. Right now the <code>update</code> function isn’t doing anything, so this is mostly placeholder code for now. The type annotation for the <code>update</code> function is <code>update : Msg -&gt; Model -&gt; ( Model, Cmd Msg )</code>, which says the function takes in two arguments (a <code>Msg</code> and a <code>Model</code>) and returns a tuple of type <code>( Model, Cmd Msg )</code>, which contains the updated model and a command for side effects. Right now our app doesn’t have any messages, so we have the line <code>type Msg = NoOp</code> as a placeholder for now — eventually we’ll have messages for selecting notes, clicking on the new button, etc.</p>
<pre class="language-elm"><code class="language-elm"><span class="token comment">-- UPDATE</span><br><br><span class="token keyword">type</span> <span class="token constant">Msg</span><br>    <span class="token operator">=</span> <span class="token constant">NoOp</span><br><br><span class="token hvariable">update</span> <span class="token operator">:</span> <span class="token constant">Msg</span> <span class="token operator">-></span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token punctuation">(</span> <span class="token constant">Model</span><span class="token punctuation">,</span> <span class="token constant">Cmd</span> <span class="token constant">Msg</span> <span class="token punctuation">)</span><br><span class="token hvariable">update</span> <span class="token hvariable">msg</span> <span class="token hvariable">model</span> <span class="token operator">=</span><br>    <span class="token punctuation">(</span> <span class="token hvariable">model</span><span class="token punctuation">,</span> <span class="token hvariable">Cmd.none</span> <span class="token punctuation">)</span></code></pre>
<p>The next function is the <code>subscriptions</code> function, which are used to listen to events. Again, we’re not using subscriptions right now, so this code is essentially doing nothing. Subscriptions are for listening to events like mouse movements, web sockets, etc., which we won’t need for this app.</p>
<pre class="language-elm"><code class="language-elm"><span class="token comment">-- SUBSCRIPTIONS</span><br><br><span class="token hvariable">subscriptions</span> <span class="token operator">:</span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token constant">Sub</span> <span class="token constant">Msg</span><br><span class="token hvariable">subscriptions</span> <span class="token hvariable">model</span> <span class="token operator">=</span><br>    <span class="token hvariable">Sub.none</span></code></pre>
<p>The final function is the <code>view</code> function, which defines the HTML output. This is the same code we started with to generate the HTML, broken down into sub-functions. The <code>view</code> function type annotation is <code>view : Model -&gt; Html Msg</code>, which means it takes in the model (our list of notes) as the argument and outputs HTML.</p>
<pre class="language-elm"><code class="language-elm"><span class="token comment">-- VIEW</span><br><br><span class="token hvariable">view</span> <span class="token operator">:</span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span><br><span class="token hvariable">view</span> <span class="token hvariable">model</span> <span class="token operator">=</span><br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">id</span> <span class="token string">"app"</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">[</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">[</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"New"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Delete"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">input</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-search"</span><span class="token punctuation">,</span> <span class="token hvariable">type_</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token hvariable">placeholder</span> <span class="token string">"Search..."</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>            <span class="token punctuation">]</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-container"</span> <span class="token punctuation">]</span><br>            <span class="token punctuation">[</span> <span class="token hvariable">viewNoteSelectors</span> <span class="token hvariable">model</span><br>            <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor"</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-info"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">,</span> <span class="token hvariable">textarea</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-input"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"First note..."</span> <span class="token punctuation">]</span><br>                <span class="token punctuation">]</span><br>            <span class="token punctuation">]</span><br>        <span class="token punctuation">]</span><br><br><span class="token hvariable">viewNoteSelectors</span> <span class="token operator">:</span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span><br><span class="token hvariable">viewNoteSelectors</span> <span class="token hvariable">model</span> <span class="token operator">=</span><br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selectors"</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">(</span><span class="token hvariable">List.map</span> <span class="token punctuation">(</span>\<span class="token hvariable">note</span> <span class="token operator">-></span> <span class="token hvariable">viewNoteSelector</span> <span class="token hvariable">note</span><span class="token punctuation">)</span> <span class="token hvariable">model</span><span class="token punctuation">.</span><span class="token hvariable">notes</span><span class="token punctuation">)</span><br><br><span class="token hvariable">viewNoteSelector</span> <span class="token operator">:</span> <span class="token constant">Note</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span><br><span class="token hvariable">viewNoteSelector</span> <span class="token hvariable">note</span> <span class="token operator">=</span><br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector"</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-title"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token hvariable">note</span><span class="token punctuation">.</span><span class="token hvariable">body</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">,</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-timestamp"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token punctuation">(</span><span class="token hvariable">String.fromInt</span> <span class="token hvariable">note</span><span class="token punctuation">.</span><span class="token hvariable">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><br>        <span class="token punctuation">]</span></code></pre>
<p>You can see the complete <strong><code>Notes.elm</code></strong> file <a href="https://github.com/peterxjang/notes-app-elm/blob/def4666dd0c9bc897ce9acd2c44ae23ef69020ee/Notes.elm">here</a>.</p>
<p>Unlike our <a href="comparing-frontend-approaches-part-5-react.html">React approach</a>, we aren’t going to break this app into components up front, or ever for that matter. We will be breaking things up into functions, but only when there’s a need to do so. In this case I made a sub-function <code>viewNoteSelectors</code> which is responsible for generating the <code>&lt;div class=&quot;note-selectors&quot;&gt;</code> HTML. It does this by mapping over the list of notes and calling up the <code>viewNoteSelector</code> function, which takes in a note and outputs the <code>&lt;div class=&quot;note-selector&quot;&gt;</code> HTML.</p>
<p>Although this seems like a lot of code to get started, keep in mind that every Elm app will consist of the same 4 functions (init, view, update, and subscriptions). This takes away a lot of the decision fatigue that comes with building frontend apps.</p>
<h3 id="compute-current-timestamps">Compute current timestamps <a class="direct-link" href="#compute-current-timestamps">#</a></h3>
<p>Now let’s circle back and properly compute the current timestamps. This was trivial in JavaScript, but since it involves side effects it takes more effort to wire up in Elm. First we need to install a new package to handle time:</p>
<pre><code>$ elm install elm/time
</code></pre>
<p>Once it’s installed, you would change the code in <strong><code>Notes.elm</code></strong> as follows (I’m not showing the <code>subscriptions</code> and <code>view</code> functions since they didn’t change):</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">module Notes exposing (..)</span><br><span class="highlight-line"></span><br><span class="highlight-line">import Browser</span><br><span class="highlight-line">import Html exposing (..)</span><br><span class="highlight-line">import Html.Attributes exposing (..)</span><br><ins class="highlight-line highlight-line-add">import Task</ins><br><ins class="highlight-line highlight-line-add">import Time</ins><br><span class="highlight-line"></span><br><span class="highlight-line">main =</span><br><span class="highlight-line">    Browser.element</span><br><span class="highlight-line">        { init = init</span><br><span class="highlight-line">        , view = view</span><br><span class="highlight-line">        , update = update</span><br><span class="highlight-line">        , subscriptions = subscriptions</span><br><span class="highlight-line">        }</span><br><span class="highlight-line">        </span><br><span class="highlight-line">-- MODEL</span><br><span class="highlight-line"></span><br><span class="highlight-line">type alias Note =</span><br><span class="highlight-line">    { id : Int, body : String, timestamp : Int }</span><br><span class="highlight-line">    </span><br><span class="highlight-line">type alias Model =</span><br><span class="highlight-line">    { notes : List Note }</span><br><span class="highlight-line">    </span><br><span class="highlight-line">init : () -> ( Model, Cmd Msg )</span><br><span class="highlight-line">init _ =</span><br><span class="highlight-line">    ( { notes =</span><br><span class="highlight-line">            [ { id = 1, body = "First note...", timestamp = 0 }</span><br><span class="highlight-line">            , { id = 2, body = "Second note...", timestamp = 0 }</span><br><span class="highlight-line">            , { id = 3, body = "Third note...", timestamp = 0 }</span><br><span class="highlight-line">            ]</span><br><span class="highlight-line">      }</span><br><ins class="highlight-line highlight-line-add">    , Task.perform InitializeNotesTimestamps Time.now</ins><br><span class="highlight-line">    )</span><br><span class="highlight-line">    </span><br><span class="highlight-line">-- UPDATE</span><br><span class="highlight-line"></span><br><span class="highlight-line">type Msg</span><br><ins class="highlight-line highlight-line-add">    = InitializeNotesTimestamps Time.Posix</ins><br><span class="highlight-line">    </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )</span><br><span class="highlight-line">update msg model =</span><br><ins class="highlight-line highlight-line-add">    case msg of</ins><br><ins class="highlight-line highlight-line-add">        InitializeNotesTimestamps time -></ins><br><ins class="highlight-line highlight-line-add">            ( { model</ins><br><ins class="highlight-line highlight-line-add">                | notes = List.map (\note -> { note | timestamp = Time.posixToMillis time }) model.notes</ins><br><ins class="highlight-line highlight-line-add">              }</ins><br><ins class="highlight-line highlight-line-add">            , Cmd.none</ins><br><ins class="highlight-line highlight-line-add">            )</ins><br><span class="highlight-line">            </span><br><span class="highlight-line">-- SUBSCRIPTIONS</span><br><span class="highlight-line">-- ...</span><br><span class="highlight-line"></span><br><span class="highlight-line">-- VIEW</span><br><span class="highlight-line">-- ...</span></code></pre>
<p>Let’s break this down piece by piece:</p>
<ul>
<li>First we import the <code>Task</code> and <code>Time</code> libraries, which are needed to create timestamps.</li>
<li>The <code>init</code> function now runs a command with the <a href="http://package.elm-lang.org/packages/elm-lang/core/latest/Task#perform"><code>Task.perform</code></a> function, which takes in two arguments — in this case the <code>InitializeTimestamps</code> message and <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Time#now"><code>Time.now</code></a>, which gets the POSIX representation of time when the task is run (similar to JavaScript’s <code>Date.now()</code>, although it isn’t stored in Elm as an integer).</li>
<li>The <code>update</code> section now has something to do! First we change the Msg definition to be a message called <code>InitializeNotesTimestamps</code> (which our init function will send out), which comes with the <code>time</code> result from <code>Time.now</code>.</li>
<li>Now we can change the <code>update</code> function itself to respond to the case where the message is <code>InitializeNotesTimestamps</code> (right now this is the only possibility, but we will be adding more cases soon). In that case the function will update every note with the given <code>time</code> (which in this case must first be converted into milliseconds using <code>Time.posixToMillis</code>).</li>
</ul>
<p>There’s no doubt that this is quite a bit of work in Elm for something that was trivial in JavaScript. Consider this an up front cost — this architecture provides some absolute guarantees about the safety and structure of the code. The purity in a functional language like Elm makes certain features with side effects harder to implement, but makes it literally impossible to be lazy and write something like jQuery spaghetti.</p>
<h3 id="use-functions-to-sort-and-format-notes">Use functions to sort and format notes <a class="direct-link" href="#use-functions-to-sort-and-format-notes">#</a></h3>
<p>Now let’s write more functions, this time to sort and format the notes. Here’s the code in <strong><code>Notes.elm</code></strong> (focusing on the changes in the <code>view</code> function):</p>
<pre class="language-elm"><code class="language-elm"><span class="token comment">-- VIEW</span><br><br><span class="token hvariable">view</span> <span class="token operator">:</span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span>  <br><span class="token hvariable">view</span> <span class="token hvariable">model</span> <span class="token operator">=</span>  <br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">id</span> <span class="token string">"app"</span> <span class="token punctuation">]</span>  <br>        <span class="token punctuation">[</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar"</span> <span class="token punctuation">]</span>  <br>            <span class="token punctuation">[</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"New"</span> <span class="token punctuation">]</span>  <br>            <span class="token punctuation">,</span> <span class="token hvariable">button</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-button"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Delete"</span> <span class="token punctuation">]</span>  <br>            <span class="token punctuation">,</span> <span class="token hvariable">input</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"toolbar-search"</span><span class="token punctuation">,</span> <span class="token hvariable">type_</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token hvariable">placeholder</span> <span class="token string">"Search..."</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <br>            <span class="token punctuation">]</span>  <br>        <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-container"</span> <span class="token punctuation">]</span>  <br>            <span class="token punctuation">[</span> <span class="token hvariable">viewNoteSelectors</span> <span class="token hvariable">model</span>  <br>            <span class="token punctuation">,</span> <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor"</span> <span class="token punctuation">]</span>  <br>                <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-info"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"Timestamp here..."</span> <span class="token punctuation">]</span>  <br>                <span class="token punctuation">,</span> <span class="token hvariable">textarea</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-editor-input"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token string">"First note..."</span> <span class="token punctuation">]</span>  <br>                <span class="token punctuation">]</span>  <br>            <span class="token punctuation">]</span>  <br>        <span class="token punctuation">]</span><br><br><span class="token hvariable">viewNoteSelectors</span> <span class="token operator">:</span> <span class="token constant">Model</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span>  <br><span class="token hvariable">viewNoteSelectors</span> <span class="token hvariable">model</span> <span class="token operator">=</span>  <br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selectors"</span> <span class="token punctuation">]</span>  <br>    <span class="token punctuation">(</span><span class="token hvariable">model</span><span class="token punctuation">.</span><span class="token hvariable">notes</span>  <br>            <span class="token operator">|></span> <span class="token hvariable">List.sortBy</span> <span class="token punctuation">.</span><span class="token hvariable">timestamp</span>  <br>            <span class="token operator">|></span> <span class="token hvariable">List.reverse</span>  <br>            <span class="token operator">|></span> <span class="token hvariable">List.map</span> <span class="token punctuation">(</span><span class="token hvariable">note</span> <span class="token operator">-></span> <span class="token hvariable">viewNoteSelector</span> <span class="token hvariable">note</span><span class="token punctuation">)</span>  <br>        <span class="token punctuation">)</span><br><br><span class="token hvariable">viewNoteSelector</span> <span class="token operator">:</span> <span class="token constant">Note</span> <span class="token operator">-></span> <span class="token constant">Html</span> <span class="token constant">Msg</span>  <br><span class="token hvariable">viewNoteSelector</span> <span class="token hvariable">note</span> <span class="token operator">=</span>  <br>    <span class="token hvariable">div</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector"</span> <span class="token punctuation">]</span>  <br>        <span class="token punctuation">[</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-title"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token punctuation">(</span><span class="token hvariable">formatTitle</span> <span class="token hvariable">note</span><span class="token punctuation">.</span><span class="token hvariable">body</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>  <br>        <span class="token punctuation">,</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span> <span class="token hvariable">class</span> <span class="token string">"note-selector-timestamp"</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token hvariable">text</span> <span class="token punctuation">(</span><span class="token hvariable">formatTimestamp</span> <span class="token hvariable">note</span><span class="token punctuation">.</span><span class="token hvariable">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>  <br>        <span class="token punctuation">]</span><br><br><span class="token comment">-- HELPERS</span><br><br><span class="token hvariable">formatTitle</span> <span class="token operator">:</span> <span class="token constant">String</span> <span class="token operator">-></span> <span class="token constant">String</span>  <br><span class="token hvariable">formatTitle</span> <span class="token hvariable">body</span> <span class="token operator">=</span>  <br>    <span class="token keyword">let</span>  <br>        <span class="token hvariable">maxLength</span> <span class="token operator">=</span>  <br>            <span class="token number">20</span>  <br>        <span class="token hvariable">length</span> <span class="token operator">=</span>  <br>            <span class="token hvariable">String.length</span> <span class="token hvariable">body</span>  <br>    <span class="token keyword">in</span>  <br>    <span class="token keyword">if</span> <span class="token hvariable">length</span> <span class="token operator">></span> <span class="token hvariable">maxLength</span> <span class="token keyword">then</span>  <br>        <span class="token hvariable">String.left</span> <span class="token punctuation">(</span><span class="token hvariable">maxLength</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token hvariable">body</span> <span class="token operator">++</span> <span class="token string">"..."</span>  <br>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token hvariable">length</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>  <br>        <span class="token string">"New note"</span>  <br>    <span class="token keyword">else</span>  <br>        <span class="token hvariable">body</span><br><br><span class="token hvariable">formatTimestamp</span> <span class="token operator">:</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">String</span>  <br><span class="token hvariable">formatTimestamp</span> <span class="token hvariable">timestamp</span> <span class="token operator">=</span>  <br>    <span class="token keyword">let</span>  <br>        <span class="token hvariable">time</span> <span class="token operator">=</span>  <br>            <span class="token hvariable">Time.millisToPosix</span> <span class="token hvariable">timestamp</span>  <br>        <span class="token hvariable">hour</span> <span class="token operator">=</span>  <br>            <span class="token hvariable">String.fromInt</span> <span class="token punctuation">(</span><span class="token hvariable">Time.toHour</span> <span class="token hvariable">Time.utc</span> <span class="token hvariable">time</span><span class="token punctuation">)</span>  <br>        <span class="token hvariable">minute</span> <span class="token operator">=</span>  <br>            <span class="token hvariable">String.fromInt</span> <span class="token punctuation">(</span><span class="token hvariable">Time.toMinute</span> <span class="token hvariable">Time.utc</span> <span class="token hvariable">time</span><span class="token punctuation">)</span>  <br>        <span class="token hvariable">second</span> <span class="token operator">=</span>  <br>            <span class="token hvariable">String.fromInt</span> <span class="token punctuation">(</span><span class="token hvariable">Time.toSecond</span> <span class="token hvariable">Time.utc</span> <span class="token hvariable">time</span><span class="token punctuation">)</span>  <br>    <span class="token keyword">in</span>  <br>    <span class="token hvariable">hour</span> <span class="token operator">++</span> <span class="token string">":"</span> <span class="token operator">++</span> <span class="token hvariable">minute</span> <span class="token operator">++</span> <span class="token string">":"</span> <span class="token operator">++</span> <span class="token hvariable">second</span> <span class="token operator">++</span> <span class="token string">" UTC"</span></code></pre>
<p>Let’s go over the changes one at a time:</p>
<ul>
<li>In the <code>viewNoteSelectors</code> function, we are adding extra function calls to sort the notes by timestamp in reverse order. Note the use of the <code>|&gt;</code> operator, which is an alternative syntax for passing arguments to functions (<code>(arg |&gt; func)</code> is the same as <code>(func arg)</code>), which helps reduce parentheses.</li>
<li>In the <code>viewNoteSelector</code> function, we are using the <code>formatTitle</code> and <code>formatTimestamp</code> functions, defined below.</li>
<li>The <code>formatTitle</code> function is using the same logic we’ve used in the past. Note the use of the <code>let...in...</code> syntax, which is required when creating temporary variables in a function.</li>
<li>The <code>formatTimestamp</code> function uses the Date library to format the given timestamp (like JavaScript’s <code>.toUTCString()</code>). I’m also using <code>String.slice</code> to remove parts of the formatted string that aren’t needed.</li>
</ul>
<p>Note that the formatted timestamp isn’t as detailed as JavaScript’s <code>.toUTCString()</code>. Elm doesn’t come with an equivalent function, so I’m using a simplified formatting helper function that only returns the hours/minutes/seconds. To make it more detailed can get quite involved (getting the <a href="https://package.elm-lang.org/packages/elm/time/latest/Time#here">user’s time zone</a>, formatting <a href="https://package.elm-lang.org/packages/elm/time/latest/Time#Weekday">weekday</a>, <a href="https://package.elm-lang.org/packages/elm/time/latest/Time#Month">month names</a>, etc.), which is outside the scope of this article, so the simplified function will do for now.</p>
<h3 id="select-a-note-on-title-click">Select a note on title click <a class="direct-link" href="#select-a-note-on-title-click">#</a></h3>
<p>Now let’s implement the ability to actually select notes. Clicking on a note title should both highlight the selected note on the left as well as display the contents in the editor on the right. The code in <strong><code>Notes.elm</code></strong> will change accordingly:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">module Notes exposing (..)</span><br><span class="highlight-line">  </span><br><span class="highlight-line">import Browser  </span><br><span class="highlight-line">import Html exposing (..)  </span><br><span class="highlight-line">import Html.Attributes exposing (..)  </span><br><ins class="highlight-line highlight-line-add">import Html.Events exposing (..)  </ins><br><span class="highlight-line">import Task  </span><br><span class="highlight-line">import Time  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">main =  </span><br><span class="highlight-line">    Browser.element  </span><br><span class="highlight-line">        { init = init  </span><br><span class="highlight-line">        , view = view  </span><br><span class="highlight-line">        , update = update  </span><br><span class="highlight-line">        , subscriptions = subscriptions  </span><br><span class="highlight-line">        }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- MODEL  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type alias Note =  </span><br><span class="highlight-line">    { id : Int, body : String, timestamp : Int }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type alias Model =  </span><br><ins class="highlight-line highlight-line-add">    { notes : List Note, selectedNoteId : Int }  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">init : () -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">init _ =  </span><br><span class="highlight-line">    ( { notes =  </span><br><span class="highlight-line">            [ { id = 1, body = "First note...", timestamp = 0 }  </span><br><span class="highlight-line">            , { id = 2, body = "Second note...", timestamp = 0 }  </span><br><span class="highlight-line">            , { id = 3, body = "Third note...", timestamp = 0 }  </span><br><span class="highlight-line">            ]  </span><br><ins class="highlight-line highlight-line-add">      , selectedNoteId = 1  </ins><br><span class="highlight-line">      }  </span><br><span class="highlight-line">    , Task.perform InitializeNotesTimestamps Time.now  </span><br><span class="highlight-line">    )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- UPDATE  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type Msg  </span><br><span class="highlight-line">    = InitializeNotesTimestamps Time.Posix  </span><br><ins class="highlight-line highlight-line-add">    | SelectNote Int  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">update msg model =  </span><br><span class="highlight-line">    case msg of  </span><br><span class="highlight-line">        InitializeNotesTimestamps time ->  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = List.map (\note -> { note | timestamp = Time.posixToMillis time }) model.notes  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )</span><br><span class="highlight-line"></span><br><ins class="highlight-line highlight-line-add">        SelectNote id ->  </ins><br><ins class="highlight-line highlight-line-add">            ( { model | selectedNoteId = id }, Cmd.none )  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- SUBSCRIPTIONS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">subscriptions : Model -> Sub Msg  </span><br><span class="highlight-line">subscriptions model =  </span><br><span class="highlight-line">    Sub.none  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- VIEW  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">view : Model -> Html Msg  </span><br><span class="highlight-line">view model =  </span><br><span class="highlight-line">    div [ id "app" ]  </span><br><span class="highlight-line">        [ div [ class "toolbar" ]  </span><br><span class="highlight-line">            [ button [ class "toolbar-button" ] [ text "New" ]  </span><br><span class="highlight-line">            , button [ class "toolbar-button" ] [ text "Delete" ]  </span><br><span class="highlight-line">            , input [ class "toolbar-search", type_ "text", placeholder "Search..." ] []  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        , div [ class "note-container" ]  </span><br><span class="highlight-line">            [ viewNoteSelectors model  </span><br><ins class="highlight-line highlight-line-add">            , viewNoteEditor model  </ins><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelectors : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteSelectors model =  </span><br><span class="highlight-line">    div [ class "note-selectors" ]  </span><br><span class="highlight-line">        (model.notes  </span><br><span class="highlight-line">            |> List.sortBy .timestamp  </span><br><span class="highlight-line">            |> List.reverse  </span><br><ins class="highlight-line highlight-line-add">            |> List.map (\note -> viewNoteSelector note model.selectedNoteId)  </ins><br><span class="highlight-line">        )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">viewNoteSelector : Note -> Int -> Html Msg  </ins><br><ins class="highlight-line highlight-line-add">viewNoteSelector note selectedNoteId =  </ins><br><ins class="highlight-line highlight-line-add"> div [ classList [ ( "note-selector", True ), ( "active", note.id == selectedNoteId ) ], onClick (SelectNote note.id) ]  </ins><br><span class="highlight-line">        [ p [ class "note-selector-title" ] [ text (formatTitle note.body) ]  </span><br><span class="highlight-line">        , p [ class "note-selector-timestamp" ] [ text (formatTimestamp note.timestamp) ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">viewNoteEditor : Model -> Html Msg  </ins><br><ins class="highlight-line highlight-line-add">viewNoteEditor model =  </ins><br><ins class="highlight-line highlight-line-add">    case model.notes |> List.filter (\note -> note.id == model.selectedNoteId) |> List.head of  </ins><br><ins class="highlight-line highlight-line-add">        Nothing ->  </ins><br><ins class="highlight-line highlight-line-add">            div [ class "note-editor" ] []  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">        Just selectedNote ->  </ins><br><ins class="highlight-line highlight-line-add">            div [ class "note-editor" ]  </ins><br><ins class="highlight-line highlight-line-add">                [ p [ class "note-editor-info" ] [ text (formatTimestamp selectedNote.timestamp) ]  </ins><br><ins class="highlight-line highlight-line-add">                , textarea [ class "note-editor-input" ] [ text selectedNote.body ]  </ins><br><ins class="highlight-line highlight-line-add">                ]</ins><br><span class="highlight-line"></span><br><span class="highlight-line">-- HELPERS</span><br><span class="highlight-line"></span><br><span class="highlight-line">formatTitle : String -> String  </span><br><span class="highlight-line">formatTitle body =  </span><br><span class="highlight-line">    let  </span><br><span class="highlight-line">        maxLength =  </span><br><span class="highlight-line">            20</span><br><span class="highlight-line"></span><br><span class="highlight-line">    length =  </span><br><span class="highlight-line">            String.length body  </span><br><span class="highlight-line">    in  </span><br><span class="highlight-line">    if length > maxLength then  </span><br><span class="highlight-line">        String.left (maxLength - 3) body ++ "..."</span><br><span class="highlight-line"></span><br><span class="highlight-line">    else if length == 0 then  </span><br><span class="highlight-line">        "New note"</span><br><span class="highlight-line"></span><br><span class="highlight-line">    else  </span><br><span class="highlight-line">        body</span><br><span class="highlight-line"></span><br><span class="highlight-line">formatTimestamp : Int -> String  </span><br><span class="highlight-line">formatTimestamp timestamp =  </span><br><span class="highlight-line">    let  </span><br><span class="highlight-line">        time =  </span><br><span class="highlight-line">            Time.millisToPosix timestamp</span><br><span class="highlight-line"></span><br><span class="highlight-line">        hour =  </span><br><span class="highlight-line">            String.fromInt (Time.toHour Time.utc time)</span><br><span class="highlight-line"></span><br><span class="highlight-line">        minute =  </span><br><span class="highlight-line">            String.fromInt (Time.toMinute Time.utc time)</span><br><span class="highlight-line"></span><br><span class="highlight-line">        second =  </span><br><span class="highlight-line">            String.fromInt (Time.toSecond Time.utc time)  </span><br><span class="highlight-line">    in  </span><br><span class="highlight-line">    hour ++ ":" ++ minute ++ ":" ++ second ++ " UTC"</span></code></pre>
<p>Let’s go over the changes one at a time:</p>
<ul>
<li>First we import the Html.Events functions, which we will use later.</li>
<li>In the MODEL section, we are adding a new piece of data to keep track of in the model — the <code>selectedNoteId</code>, which we initialize to 1 to start off.</li>
<li>In the UPDATE section, we add a <a href="https://guide.elm-lang.org/types/union_types.html">union type</a> to Msg — now it can be a <code>InitializeTimestamps</code> or a <code>SelectNote</code> message. So we also add another case to the <code>update</code> function — if the message is <code>SelectNote</code>, we will update the <code>selectedNoteId</code> in the model accordingly.</li>
<li>In the VIEW section, the <code>viewNoteSelector</code> function has the code <code>onClick (SelectNote note.id)</code>, which is binding the DOM click event to trigger the <code>SelectNote</code> message with the note’s id.</li>
<li>In the VIEW section, the <code>viewNoteSelector</code> function also changed to take in one more argument, the <code>selectedNoteId</code>. This enables us to apply the right CSS <code>active</code> class to the div if the note is the selected note with the code <code>classList [ ( &quot;note-selector&quot;, True ), ( &quot;active&quot;, note.id == selectedNoteId ) ]</code>.</li>
<li>In the VIEW section, we also extracted the code which generates the <code>&lt;div class=&quot;note-editor&quot;&gt;</code> into a separate function called <code>viewNoteEditor</code>. This function uses the model <code>notes</code> and <code>selectedNoteId</code> data to identify which note matches the <code>selectedNoteId</code>. If nothing matches, the note editor will be an empty div. If there is a match, then the note editor will show the editor with the appropriate formatted timestamp and body.</li>
</ul>
<p>Here we see another benefit of Elm — it forces you to deal with the case where the <code>selectedNoteId</code> doesn’t match any of the notes. There’s literally no other way to write the code and have it compile. The zero notes scenario wasn’t going to be a problem until we implemented the delete functionality, but it’s reassuring to know that these safety guarantees are built in from the start!</p>
<h3 id="edit-the-selected-note-on-editor-input">Edit the selected note on editor input <a class="direct-link" href="#edit-the-selected-note-on-editor-input">#</a></h3>
<p>At this point we can select a note and it highlights accordingly, but the content of the selected note aren’t showing up in the note editor. We also need to be able to update the selected note as the user enters text in the editor. Here’s how the UPDATE and VIEW sections of the code would change in <strong><code>Notes.elm</code></strong>:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">-- UPDATE  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type Msg  </span><br><span class="highlight-line">    = InitializeNotesTimestamps Time.Posix  </span><br><span class="highlight-line">    | SelectNote Int  </span><br><ins class="highlight-line highlight-line-add">    | UpdateSelectedNoteBody String  </ins><br><ins class="highlight-line highlight-line-add">    | UpdateSelectedNoteTimestamp Time.Posix  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">update msg model =  </span><br><span class="highlight-line">    case msg of  </span><br><span class="highlight-line">        InitializeNotesTimestamps time ->  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = List.map (\note -> { note | timestamp = Time.posixToMillis time }) model.notes  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        SelectNote id ->  </span><br><span class="highlight-line">            ( { model | selectedNoteId = id }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">        UpdateSelectedNoteBody newText ->  </ins><br><ins class="highlight-line highlight-line-add">            case getSelectedNote model of  </ins><br><ins class="highlight-line highlight-line-add">                Nothing ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( model, Cmd.none )  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                Just selectedNote ->  </ins><br><ins class="highlight-line highlight-line-add">                    let  </ins><br><ins class="highlight-line highlight-line-add">                        updateSelectedNote note =  </ins><br><ins class="highlight-line highlight-line-add">                            if note.id == model.selectedNoteId then  </ins><br><ins class="highlight-line highlight-line-add">                                { note | body = newText }  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                            else  </ins><br><ins class="highlight-line highlight-line-add">                                note  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                        newNotes =  </ins><br><ins class="highlight-line highlight-line-add">                            List.map updateSelectedNote model.notes  </ins><br><ins class="highlight-line highlight-line-add">                    in  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | notes = newNotes }  </ins><br><ins class="highlight-line highlight-line-add">                    , Task.perform UpdateSelectedNoteTimestamp Time.now  </ins><br><ins class="highlight-line highlight-line-add">                    )  </ins><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">        UpdateSelectedNoteTimestamp newTime ->  </ins><br><ins class="highlight-line highlight-line-add">            case getSelectedNote model of  </ins><br><ins class="highlight-line highlight-line-add">                Nothing ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( model, Cmd.none )  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                Just selectedNote ->  </ins><br><ins class="highlight-line highlight-line-add">                    let  </ins><br><ins class="highlight-line highlight-line-add">                        updateSelectedNote note =  </ins><br><ins class="highlight-line highlight-line-add">                            if note.id == model.selectedNoteId then  </ins><br><ins class="highlight-line highlight-line-add">                                { note | timestamp = Time.posixToMillis newTime }  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                            else  </ins><br><ins class="highlight-line highlight-line-add">                                note  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                        newNotes =  </ins><br><ins class="highlight-line highlight-line-add">                            List.map updateSelectedNote model.notes  </ins><br><ins class="highlight-line highlight-line-add">                    in  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | notes = newNotes }, Cmd.none )  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- SUBSCRIPTIONS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">subscriptions : Model -> Sub Msg  </span><br><span class="highlight-line">subscriptions model =  </span><br><span class="highlight-line">    Sub.none  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- VIEW  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">view : Model -> Html Msg  </span><br><span class="highlight-line">view model =  </span><br><span class="highlight-line">    div [ id "app" ]  </span><br><span class="highlight-line">        [ div [ class "toolbar" ]  </span><br><span class="highlight-line">            [ button [ class "toolbar-button" ] [ text "New" ]  </span><br><span class="highlight-line">            , button [ class "toolbar-button" ] [ text "Delete" ]  </span><br><span class="highlight-line">            , input [ class "toolbar-search", type_ "text", placeholder "Search..." ] []  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        , div [ class "note-container" ]  </span><br><span class="highlight-line">            [ viewNoteSelectors model  </span><br><span class="highlight-line">            , viewNoteEditor model  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelectors : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteSelectors model =  </span><br><span class="highlight-line">    div [ class "note-selectors" ]  </span><br><span class="highlight-line">        (model.notes  </span><br><span class="highlight-line">            |> List.sortBy .timestamp  </span><br><span class="highlight-line">            |> List.reverse  </span><br><span class="highlight-line">            |> List.map (\note -> viewNoteSelector note model.selectedNoteId)  </span><br><span class="highlight-line">        )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelector : Note -> Int -> Html Msg  </span><br><span class="highlight-line">viewNoteSelector note selectedNoteId =  </span><br><span class="highlight-line">    div [ classList [ ( "note-selector", True ), ( "active", note.id == selectedNoteId ) ], onClick (SelectNote note.id) ]  </span><br><span class="highlight-line">        [ p [ class "note-selector-title" ] [ text (formatTitle note.body) ]  </span><br><span class="highlight-line">        , p [ class "note-selector-timestamp" ] [ text (formatTimestamp note.timestamp) ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteEditor : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteEditor model =  </span><br><ins class="highlight-line highlight-line-add">    case getSelectedNote model of  </ins><br><span class="highlight-line">        Nothing ->  </span><br><span class="highlight-line">            div [ class "note-editor" ] []  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        Just selectedNote ->  </span><br><span class="highlight-line">            div [ class "note-editor" ]  </span><br><span class="highlight-line">                [ p [ class "note-editor-info" ] [ text (formatTimestamp selectedNote.timestamp) ]  </span><br><ins class="highlight-line highlight-line-add">                , textarea [ class "note-editor-input", onInput UpdateSelectedNoteBody, value selectedNote.body ] []  </ins><br><span class="highlight-line">                ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- HELPERS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">getSelectedNote : Model -> Maybe Note  </ins><br><ins class="highlight-line highlight-line-add">getSelectedNote model =  </ins><br><ins class="highlight-line highlight-line-add">    model.notes |> List.filter (\note -> note.id == model.selectedNoteId) |> List.head</ins></code></pre>
<p>Let’s examine the changes:</p>
<ul>
<li>In the UPDATE section, the <code>Msg</code> now gets two more types — <code>UpdateSelectedNoteBody</code> and <code>UpdateSelectedNoteTimestamp</code>. The two are related — if the user enters text in the note editor, it will trigger the <code>UpdateSelectedNoteBody</code> case in the <code>update</code> function, which will update the body of the selected note. When it’s done, it will trigger the <code>Time.now</code> task, which will trigger the <code>UpdateSelectedNoteTimestamp</code> message when it’s ready. When the <code>update</code> function is called with the <code>UpdateSelectedNoteTimestamp</code> case, it will update the selected note with the given time. Note that it has to determine which note matches the <code>selectedNoteId</code>, which is logic we’ve already defined, so I’ve extracted the logic into a function called <code>getSelectedNote</code> which is defined later.</li>
<li>In the VIEW section, we’ve refactored the <code>viewNoteEditor</code> to use the <code>getSelectedNote</code> function. We are also adding new attributes to the <code>textarea</code> element with the line <code>textarea [ class &quot;note-editor-input&quot;, onInput InputNoteBody, value selectedNote.body ] []</code>. This is binding the DOM input event to trigger the <code>UpdateSelectedNoteBody</code> message, as well as binding the selected note’s body to the <code>textarea</code> value.</li>
<li>In the HELPERS section, we define the <code>getSelectedNote</code> method, which is just the extracted logic of finding the selected note as before.</li>
</ul>
<h3 id="create-a-new-note-with-a-button">Create a new note with a button <a class="direct-link" href="#create-a-new-note-with-a-button">#</a></h3>
<p>Now let’s implement the ability to create a new note. Clicking on the “New” button should create a new note (new id, no body, current timestamp). The new note should become the currently selected note and appear at the top of the list of note selectors. Here’s how the UPDATE and VIEW sections of the code would change in <strong><code>Notes.elm</code></strong>:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">-- UPDATE  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type Msg  </span><br><span class="highlight-line">    = InitializeNotesTimestamps Time.Posix  </span><br><span class="highlight-line">    | SelectNote Int  </span><br><span class="highlight-line">    | UpdateSelectedNoteBody String  </span><br><span class="highlight-line">    | UpdateSelectedNoteTimestamp Time.Posix  </span><br><ins class="highlight-line highlight-line-add">    | ClickNew  </ins><br><ins class="highlight-line highlight-line-add">    | CreateNote Time.Posix  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">update msg model =  </span><br><span class="highlight-line">    case msg of  </span><br><span class="highlight-line">        InitializeTimestamps time ->  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = List.map (\note -> { note | timestamp = time }) model.notes  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        SelectNote id ->  </span><br><span class="highlight-line">            ( { model | selectedNoteId = id }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        InputNoteBody newText ->  </span><br><span class="highlight-line">            ( model, Time.now |> Task.perform (UpdateNote newText) )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        UpdateNote newText newTimestamp ->  </span><br><span class="highlight-line">            case getSelectedNote model of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( model, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just selectedNote ->  </span><br><span class="highlight-line">                    let  </span><br><span class="highlight-line">                        updateSelectedNote note =  </span><br><span class="highlight-line">                            if note.id == model.selectedNoteId then  </span><br><span class="highlight-line">                                { note | body = newText, timestamp = newTimestamp }  </span><br><span class="highlight-line">                            else  </span><br><span class="highlight-line">                                note  </span><br><span class="highlight-line">                    in  </span><br><span class="highlight-line">                    ( { model | notes = List.map updateSelectedNote model.notes }  </span><br><span class="highlight-line">                    , Cmd.none  </span><br><span class="highlight-line">                    )  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">        ClickNew ->  </ins><br><ins class="highlight-line highlight-line-add">            ( model, Time.now |> Task.perform CreateNote )  </ins><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">        CreateNote newTimestamp ->  </ins><br><ins class="highlight-line highlight-line-add">            let  </ins><br><ins class="highlight-line highlight-line-add">                newId =  </ins><br><ins class="highlight-line highlight-line-add">                    round (Time.inMilliseconds newTimestamp)  </ins><br><ins class="highlight-line highlight-line-add">            in  </ins><br><ins class="highlight-line highlight-line-add">            ( { model  </ins><br><ins class="highlight-line highlight-line-add">                | notes = [ { id = newId, body = "", timestamp = newTimestamp } ] ++ model.notes  </ins><br><ins class="highlight-line highlight-line-add">                , selectedNoteId = newId  </ins><br><ins class="highlight-line highlight-line-add">              }  </ins><br><ins class="highlight-line highlight-line-add">            , Cmd.none  </ins><br><ins class="highlight-line highlight-line-add">            )  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- VIEW  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">view : Model -> Html Msg  </span><br><span class="highlight-line">view model =  </span><br><span class="highlight-line">    div [ id "app" ]  </span><br><span class="highlight-line">        [ div [ class "toolbar" ]  </span><br><ins class="highlight-line highlight-line-add">            [ button [ class "toolbar-button", onClick ClickNew ] [ text "New" ]  </ins><br><span class="highlight-line">            , button [ class "toolbar-button" ] [ text "Delete" ]  </span><br><span class="highlight-line">            , input [ class "toolbar-search", type_ "text", placeholder "Search..." ] []  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        , div [ class "note-container" ]  </span><br><span class="highlight-line">            [ viewNoteSelectors model  </span><br><span class="highlight-line">            , viewNoteEditor model  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        ]</span></code></pre>
<p>Let’s examine the changes:</p>
<ul>
<li>In the UPDATE section, the <code>Msg</code> now gets two more types — <code>ClickNew</code> and <code>CreateNote</code>. The two are related — if the user clicks the “New” button, it will trigger the <code>ClickNew</code> message, which will in turn trigger the <code>Time.now</code> task which will run the <code>CreateNote</code> message when it’s ready. At that point the <code>CreateNote</code> case in the <code>update</code> function will have the timestamp and can update the model with a new note and <code>selectedNoteId</code>.</li>
<li>In the VIEW section, the only thing that changes is the “New” button — we add an <code>onClick ClickNew</code> attribute to the button, which binds the DOM on click event to trigger the <code>ClickNew</code> message.</li>
</ul>
<p>Here we’re really starting to see the beauty of The Elm Architecture. Features like this are very simple to wire up, without any of the overhead that we saw with different JavaScript component approaches where we had to pass around a lot of info between parents and children.</p>
<h3 id="delete-the-selected-note-with-a-button">Delete the selected note with a button <a class="direct-link" href="#delete-the-selected-note-with-a-button">#</a></h3>
<p>Wiring up this feature is pretty similar to the new note feature, with a couple of extra considerations. Here’s how the UPDATE and VIEW sections of the code would change in <strong><code>Notes.elm</code></strong>:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">-- UPDATE  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type Msg  </span><br><span class="highlight-line">    = InitializeNotesTimestamps Time.Posix  </span><br><span class="highlight-line">    | SelectNote Int  </span><br><span class="highlight-line">    | UpdateSelectedNoteBody String  </span><br><span class="highlight-line">    | UpdateSelectedNoteTimestamp Time.Posix  </span><br><span class="highlight-line">    | ClickNew  </span><br><span class="highlight-line">    | CreateNote Time.Posix </span><br><ins class="highlight-line highlight-line-add">    | ClickDelete  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">update msg model =  </span><br><span class="highlight-line">    case msg of  </span><br><span class="highlight-line">        InitializeNotesTimestamps time ->  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = List.map (\note -> { note | timestamp = Time.posixToMillis time }) model.notes  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        SelectNote id ->  </span><br><span class="highlight-line">            ( { model | selectedNoteId = id }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        UpdateSelectedNoteBody newText ->  </span><br><span class="highlight-line">            case getSelectedNote model of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( model, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just selectedNote ->  </span><br><span class="highlight-line">                    let  </span><br><span class="highlight-line">                        updateSelectedNote note =  </span><br><span class="highlight-line">                            if note.id == model.selectedNoteId then  </span><br><span class="highlight-line">                                { note | body = newText }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                            else  </span><br><span class="highlight-line">                                note  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                        newNotes =  </span><br><span class="highlight-line">                            List.map updateSelectedNote model.notes  </span><br><span class="highlight-line">                    in  </span><br><span class="highlight-line">                    ( { model | notes = newNotes }  </span><br><span class="highlight-line">                    , Task.perform UpdateSelectedNoteTimestamp Time.now  </span><br><span class="highlight-line">                    )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        UpdateSelectedNoteTimestamp newTime ->  </span><br><span class="highlight-line">            case getSelectedNote model of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( model, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just selectedNote ->  </span><br><span class="highlight-line">                    let  </span><br><span class="highlight-line">                        updateSelectedNote note =  </span><br><span class="highlight-line">                            if note.id == model.selectedNoteId then  </span><br><span class="highlight-line">                                { note | timestamp = Time.posixToMillis newTime }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                            else  </span><br><span class="highlight-line">                                note  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                        newNotes =  </span><br><span class="highlight-line">                            List.map updateSelectedNote model.notes  </span><br><span class="highlight-line">                    in  </span><br><span class="highlight-line">                    ( { model | notes = newNotes }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        ClickNew ->  </span><br><span class="highlight-line">            ( model, Task.perform CreateNote Time.now )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        CreateNote newTime ->  </span><br><span class="highlight-line">            let  </span><br><span class="highlight-line">                newTimestamp =  </span><br><span class="highlight-line">                    Time.posixToMillis newTime  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                newId =  </span><br><span class="highlight-line">                    newTimestamp  </span><br><span class="highlight-line">            in  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = [ { id = newId, body = "", timestamp = newTimestamp } ] ++ model.notes  </span><br><span class="highlight-line">                , selectedNoteId = newId  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )</span><br><span class="highlight-line"></span><br><ins class="highlight-line highlight-line-add">        ClickDelete ->  </ins><br><ins class="highlight-line highlight-line-add">            let  </ins><br><ins class="highlight-line highlight-line-add">                newNotes =  </ins><br><ins class="highlight-line highlight-line-add">                    List.filter (\note -> note.id /= model.selectedNoteId) model.notes  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                firstVisibleNote =  </ins><br><ins class="highlight-line highlight-line-add">                    newNotes |> sortNotes |> List.head  </ins><br><ins class="highlight-line highlight-line-add">            in  </ins><br><ins class="highlight-line highlight-line-add">            case firstVisibleNote of  </ins><br><ins class="highlight-line highlight-line-add">                Nothing ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | notes = newNotes }, Cmd.none )  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                Just availableNote ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | notes = newNotes, selectedNoteId = availableNote.id }, Cmd.none )  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line"></span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- VIEW  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">view : Model -> Html Msg  </span><br><span class="highlight-line">view model =  </span><br><span class="highlight-line">    div [ id "app" ]  </span><br><span class="highlight-line">        [ div [ class "toolbar" ]  </span><br><span class="highlight-line">            [ button [ class "toolbar-button", onClick ClickNew ] [ text "New" ]  </span><br><ins class="highlight-line highlight-line-add">            , button [ class "toolbar-button", onClick ClickDelete ] [ text "Delete" ]  </ins><br><span class="highlight-line">            , input [ class "toolbar-search", type_ "text", placeholder "Search..." ] []  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        , div [ class "note-container" ]  </span><br><span class="highlight-line">            [ viewNoteSelectors model  </span><br><span class="highlight-line">            , viewNoteEditor model  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelectors : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteSelectors model =  </span><br><span class="highlight-line">    div [ class "note-selectors" ]  </span><br><span class="highlight-line">        (model.notes  </span><br><ins class="highlight-line highlight-line-add">            |> sortNotes  </ins><br><span class="highlight-line">            |> List.map (\note -> viewNoteSelector note model.selectedNoteId)  </span><br><span class="highlight-line">        )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelector : Note -> Int -> Html Msg  </span><br><span class="highlight-line">viewNoteSelector note selectedNoteId =  </span><br><span class="highlight-line">    div [ classList [ ( "note-selector", True ), ( "active", note.id == selectedNoteId ) ], onClick (SelectNote note.id) ]  </span><br><span class="highlight-line">        [ p [ class "note-selector-title" ] [ text (formatTitle note.body) ]  </span><br><span class="highlight-line">        , p [ class "note-selector-timestamp" ] [ text (formatTimestamp note.timestamp) ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteEditor : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteEditor model =  </span><br><span class="highlight-line">    case getSelectedNote model of  </span><br><span class="highlight-line">        Nothing ->  </span><br><span class="highlight-line">            div [ class "note-editor" ] []  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        Just selectedNote ->  </span><br><span class="highlight-line">            div [ class "note-editor" ]  </span><br><span class="highlight-line">                [ p [ class "note-editor-info" ] [ text (formatTimestamp selectedNote.timestamp) ]  </span><br><span class="highlight-line">                , textarea [ class "note-editor-input", onInput UpdateSelectedNoteBody, value selectedNote.body ] []  </span><br><span class="highlight-line">                ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- HELPERS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">sortNotes : List Note -> List Note  </ins><br><ins class="highlight-line highlight-line-add">sortNotes notes =  </ins><br><ins class="highlight-line highlight-line-add">    notes |> List.sortBy .timestamp |> List.reverse</ins></code></pre>
<p>Let’s examine the changes:</p>
<ul>
<li>In the UPDATE section, the <code>Msg</code> now one more type— <code>ClickDelete</code>, which will be wired up to run whenever the user clicks the “Delete” button. The <code>update</code> function with the <code>ClickDelete</code> case has to both delete the selected note (using <code>List.filter</code>) and select a new note, which should be the top of the sorted notes. Here I extracted the logic to sort the notes into a separate <code>sortNotes</code> function (defined later) to keep the code DRY.</li>
<li>In the VIEW section, the only significant change is the “Delete” button — we add an <code>onClick ClickDelete</code> attribute to the button, which binds the DOM on click event to trigger the <code>ClickDelete</code> message. The only other change is refactoring the <code>viewNoteSelectors</code> function to use the <code>sortNotes</code> function to keep the code DRY.</li>
</ul>
<p>Again, this change was a lot simpler to make compared to our other approaches, particularly in this case because Elm forced us to handle the case of no notes earlier!</p>
<h3 id="filter-notes-on-search-input">Filter notes on search input <a class="direct-link" href="#filter-notes-on-search-input">#</a></h3>
<p>The final feature is to be able to search notes immediately as you type in the search input. Since this is the last feature, let’s look at the code in <strong><code>Notes.elm</code></strong> in its entirety:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">module Notes exposing (..)  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">import Browser  </span><br><span class="highlight-line">import Html exposing (..)  </span><br><span class="highlight-line">import Html.Attributes exposing (..)  </span><br><span class="highlight-line">import Html.Events exposing (..)  </span><br><span class="highlight-line">import Task  </span><br><span class="highlight-line">import Time  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">main =  </span><br><span class="highlight-line">    Browser.element  </span><br><span class="highlight-line">        { init = init  </span><br><span class="highlight-line">        , view = view  </span><br><span class="highlight-line">        , update = update  </span><br><span class="highlight-line">        , subscriptions = subscriptions  </span><br><span class="highlight-line">        }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- MODEL  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type alias Note =  </span><br><span class="highlight-line">    { id : Int, body : String, timestamp : Int }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type alias Model =  </span><br><ins class="highlight-line highlight-line-add">    { notes : List Note, selectedNoteId : Int, searchNoteText : String }  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">init : () -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">init _ =  </span><br><span class="highlight-line">    ( { notes =  </span><br><span class="highlight-line">            [ { id = 1, body = "First note...", timestamp = 0 }  </span><br><span class="highlight-line">            , { id = 2, body = "Second note...", timestamp = 0 }  </span><br><span class="highlight-line">            , { id = 3, body = "Third note...", timestamp = 0 }  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">      , selectedNoteId = 1  </span><br><ins class="highlight-line highlight-line-add">      , searchNoteText = ""  </ins><br><span class="highlight-line">      }  </span><br><span class="highlight-line">    , Task.perform InitializeNotesTimestamps Time.now  </span><br><span class="highlight-line">    )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- UPDATE  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">type Msg  </span><br><span class="highlight-line">    = InitializeNotesTimestamps Time.Posix  </span><br><span class="highlight-line">    | SelectNote Int  </span><br><span class="highlight-line">    | UpdateSelectedNoteBody String  </span><br><span class="highlight-line">    | UpdateSelectedNoteTimestamp Time.Posix  </span><br><span class="highlight-line">    | ClickNew  </span><br><span class="highlight-line">    | CreateNote Time.Posix  </span><br><span class="highlight-line">    | ClickDelete  </span><br><ins class="highlight-line highlight-line-add">    | InputSearch String  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">update : Msg -> Model -> ( Model, Cmd Msg )  </span><br><span class="highlight-line">update msg model =  </span><br><span class="highlight-line">    case msg of  </span><br><span class="highlight-line">        InitializeNotesTimestamps time ->  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = List.map (\note -> { note | timestamp = Time.posixToMillis time }) model.notes  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        SelectNote id ->  </span><br><span class="highlight-line">            ( { model | selectedNoteId = id }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        UpdateSelectedNoteBody newText ->  </span><br><span class="highlight-line">            case getSelectedNote model of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( model, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just selectedNote ->  </span><br><span class="highlight-line">                    let  </span><br><span class="highlight-line">                        updateSelectedNote note =  </span><br><span class="highlight-line">                            if note.id == model.selectedNoteId then  </span><br><span class="highlight-line">                                { note | body = newText }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                            else  </span><br><span class="highlight-line">                                note  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                        newNotes =  </span><br><span class="highlight-line">                            List.map updateSelectedNote model.notes  </span><br><span class="highlight-line">                    in  </span><br><span class="highlight-line">                    ( { model | notes = newNotes }  </span><br><span class="highlight-line">                    , Task.perform UpdateSelectedNoteTimestamp Time.now  </span><br><span class="highlight-line">                    )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        UpdateSelectedNoteTimestamp newTime ->  </span><br><span class="highlight-line">            case getSelectedNote model of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( model, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just selectedNote ->  </span><br><span class="highlight-line">                    let  </span><br><span class="highlight-line">                        updateSelectedNote note =  </span><br><span class="highlight-line">                            if note.id == model.selectedNoteId then  </span><br><span class="highlight-line">                                { note | timestamp = Time.posixToMillis newTime }  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                            else  </span><br><span class="highlight-line">                                note  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                        newNotes =  </span><br><span class="highlight-line">                            List.map updateSelectedNote model.notes  </span><br><span class="highlight-line">                    in  </span><br><span class="highlight-line">                    ( { model | notes = newNotes }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        ClickNew ->  </span><br><span class="highlight-line">            ( model, Task.perform CreateNote Time.now )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        CreateNote newTime ->  </span><br><span class="highlight-line">            let  </span><br><span class="highlight-line">                newTimestamp =  </span><br><span class="highlight-line">                    Time.posixToMillis newTime  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                newId =  </span><br><span class="highlight-line">                    newTimestamp  </span><br><span class="highlight-line">            in  </span><br><span class="highlight-line">            ( { model  </span><br><span class="highlight-line">                | notes = [ { id = newId, body = "", timestamp = newTimestamp } ] ++ model.notes  </span><br><span class="highlight-line">                , selectedNoteId = newId  </span><br><span class="highlight-line">              }  </span><br><span class="highlight-line">            , Cmd.none  </span><br><span class="highlight-line">            )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        ClickDelete ->  </span><br><span class="highlight-line">            let  </span><br><span class="highlight-line">                newNotes =  </span><br><span class="highlight-line">                    List.filter (\note -> note.id /= model.selectedNoteId) model.notes  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                firstVisibleNote =  </span><br><ins class="highlight-line highlight-line-add">                    getFirstVisibleNote newNotes model.searchNoteText  </ins><br><span class="highlight-line">            in  </span><br><span class="highlight-line">            case firstVisibleNote of  </span><br><span class="highlight-line">                Nothing ->  </span><br><span class="highlight-line">                    ( { model | notes = newNotes }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">                Just availableNote ->  </span><br><span class="highlight-line">                    ( { model | notes = newNotes, selectedNoteId = availableNote.id }, Cmd.none )  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">        InputSearch searchNoteText ->  </ins><br><ins class="highlight-line highlight-line-add">            let  </ins><br><ins class="highlight-line highlight-line-add">                firstVisibleNote =  </ins><br><ins class="highlight-line highlight-line-add">                    getFirstVisibleNote model.notes searchNoteText  </ins><br><ins class="highlight-line highlight-line-add">            in  </ins><br><ins class="highlight-line highlight-line-add">            case firstVisibleNote of  </ins><br><ins class="highlight-line highlight-line-add">                Nothing ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | searchNoteText = searchNoteText, selectedNoteId = -1 }, Cmd.none )  </ins><br><ins class="highlight-line highlight-line-add">  </ins><br><ins class="highlight-line highlight-line-add">                Just availableNote ->  </ins><br><ins class="highlight-line highlight-line-add">                    ( { model | searchNoteText = searchNoteText, selectedNoteId = availableNote.id }, Cmd.none )  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- SUBSCRIPTIONS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">subscriptions : Model -> Sub Msg  </span><br><span class="highlight-line">subscriptions model =  </span><br><span class="highlight-line">    Sub.none  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- VIEW  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">view : Model -> Html Msg  </span><br><span class="highlight-line">view model =  </span><br><span class="highlight-line">    div [ id "app" ]  </span><br><span class="highlight-line">        [ div [ class "toolbar" ]  </span><br><span class="highlight-line">            [ button [ class "toolbar-button", onClick ClickNew ] [ text "New" ]  </span><br><span class="highlight-line">            , button [ class "toolbar-button", onClick ClickDelete ] [ text "Delete" ]  </span><br><ins class="highlight-line highlight-line-add">            , input [ class "toolbar-search", type_ "text", placeholder "Search...", onInput InputSearch ] []  </ins><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        , div [ class "note-container" ]  </span><br><span class="highlight-line">            [ viewNoteSelectors model  </span><br><span class="highlight-line">            , viewNoteEditor model  </span><br><span class="highlight-line">            ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelectors : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteSelectors model =  </span><br><span class="highlight-line">    div [ class "note-selectors" ]  </span><br><span class="highlight-line">        (model.notes  </span><br><ins class="highlight-line highlight-line-add">            |> transformNotes model.searchNoteText  </ins><br><span class="highlight-line">            |> List.map (\note -> viewNoteSelector note model.selectedNoteId)  </span><br><span class="highlight-line">        )  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteSelector : Note -> Int -> Html Msg  </span><br><span class="highlight-line">viewNoteSelector note selectedNoteId =  </span><br><span class="highlight-line">    div [ classList [ ( "note-selector", True ), ( "active", note.id == selectedNoteId ) ], onClick (SelectNote note.id) ]  </span><br><span class="highlight-line">        [ p [ class "note-selector-title" ] [ text (formatTitle note.body) ]  </span><br><span class="highlight-line">        , p [ class "note-selector-timestamp" ] [ text (formatTimestamp note.timestamp) ]  </span><br><span class="highlight-line">        ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">viewNoteEditor : Model -> Html Msg  </span><br><span class="highlight-line">viewNoteEditor model =  </span><br><span class="highlight-line">    case getSelectedNote model of  </span><br><span class="highlight-line">        Nothing ->  </span><br><span class="highlight-line">            div [ class "note-editor" ] []  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        Just selectedNote ->  </span><br><span class="highlight-line">            div [ class "note-editor" ]  </span><br><span class="highlight-line">                [ p [ class "note-editor-info" ] [ text (formatTimestamp selectedNote.timestamp) ]  </span><br><span class="highlight-line">                , textarea [ class "note-editor-input", onInput UpdateSelectedNoteBody, value selectedNote.body ] []  </span><br><span class="highlight-line">                ]  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">-- HELPERS  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">getFirstVisibleNote : List Note -> String -> Maybe Note  </ins><br><ins class="highlight-line highlight-line-add">getFirstVisibleNote notes searchText =  </ins><br><ins class="highlight-line highlight-line-add">    notes  </ins><br><ins class="highlight-line highlight-line-add">        |> transformNotes searchText  </ins><br><ins class="highlight-line highlight-line-add">        |> List.head  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><ins class="highlight-line highlight-line-add">transformNotes : String -> List Note -> List Note  </ins><br><ins class="highlight-line highlight-line-add">transformNotes searchNoteText notes =  </ins><br><ins class="highlight-line highlight-line-add">    notes  </ins><br><ins class="highlight-line highlight-line-add">        |> List.filter (\note -> String.contains (String.toLower searchNoteText) (String.toLower note.body))  </ins><br><ins class="highlight-line highlight-line-add">        |> List.sortBy .timestamp  </ins><br><ins class="highlight-line highlight-line-add">        |> List.reverse  </ins><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">getSelectedNote : Model -> Maybe Note  </span><br><span class="highlight-line">getSelectedNote model =  </span><br><span class="highlight-line">    model.notes  </span><br><ins class="highlight-line highlight-line-add">        |> transformNotes model.searchNoteText  </ins><br><span class="highlight-line">        |> List.filter (\note -> note.id == model.selectedNoteId)  </span><br><span class="highlight-line">        |> List.head  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">formatTitle : String -> String  </span><br><span class="highlight-line">formatTitle body =  </span><br><span class="highlight-line">    let  </span><br><span class="highlight-line">        maxLength =  </span><br><span class="highlight-line">            20  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        length =  </span><br><span class="highlight-line">            String.length body  </span><br><span class="highlight-line">    in  </span><br><span class="highlight-line">    if length > maxLength then  </span><br><span class="highlight-line">        String.left (maxLength - 3) body ++ "..."  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">    else if length == 0 then  </span><br><span class="highlight-line">        "New note"  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">    else  </span><br><span class="highlight-line">        body  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">formatTimestamp : Int -> String  </span><br><span class="highlight-line">formatTimestamp timestamp =  </span><br><span class="highlight-line">    let  </span><br><span class="highlight-line">        time =  </span><br><span class="highlight-line">            Time.millisToPosix timestamp  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        hour =  </span><br><span class="highlight-line">            String.fromInt (Time.toHour Time.utc time)  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        minute =  </span><br><span class="highlight-line">            String.fromInt (Time.toMinute Time.utc time)  </span><br><span class="highlight-line">  </span><br><span class="highlight-line">        second =  </span><br><span class="highlight-line">            String.fromInt (Time.toSecond Time.utc time)  </span><br><span class="highlight-line">    in  </span><br><span class="highlight-line">    hour ++ ":" ++ minute ++ ":" ++ second ++ " UTC"</span></code></pre>
<p>Let’s examine the changes:</p>
<ul>
<li>In the MODEL section, we are adding a new piece of data to keep track of in the model — the <code>searchNoteText</code>, which we initialize to an empty string.</li>
<li>In the UPDATE section, the <code>Msg</code> now one more type— <code>InputSearch</code>, which will be wired up to run whenever the user enters text in the search input. The <code>update</code> function with the <code>InputSearch</code> case has to filter notes that match the <code>searchNoteText</code> as well as select the first visible note. Since I already had logic in the <code>ClickDelete</code> case for getting the first visible note, I extracted it into a method called <code>getFirstVisibleNote</code> to be DRY and use it in both the <code>ClickDelete</code> and <code>InputSearch</code> cases.</li>
<li>In the VIEW section, we add an <code>onInput InputSearch</code> attribute to the button, which binds the DOM input event to trigger the <code>InputSearch</code> message. We also change the <code>viewNoteSelectors</code> function to not use <code>sortNotes</code> function and use <code>transformNotes</code> instead, which both filters the list of notes as well as sorts them.</li>
<li>After the VIEW section, we define the new helper functions <code>getFirstVisibleNote</code> as well as <code>transformNotes</code> (which used to be <code>sortNotes</code>).</li>
</ul>
<p>There may be some further refactoring that can be done to make the use of <code>transformNotes</code> more clear. The beauty of Elm is that the compiler works well enough to give you confidence when making such refactors — if it compiles, it works.</p>
<p>The only file we’ve been changing this whole time is <strong><code>Notes.elm</code></strong>, which you see above. If you’re curious, you can check out the entire project at this <a href="https://github.com/peterxjang/notes-app-elm/tree/80457fb818d5af671fe23740d5f4bc2c418d1e42">repository</a>. (Side note — if you’re not a fan of having all the code in one file, there are definite patterns you can use to organize your code, but they won’t necessarily be the same patterns you may be used to in JavaScript. Check out <a href="https://twitter.com/rtfeldman">Richard Feldman</a>’s talk on <a href="https://www.youtube.com/watch?v=DoA4Txr4GUs">scaling Elm apps</a> to get a sense of what I mean!)</p>
<h3 id="conclusion">Conclusion <a class="direct-link" href="#conclusion">#</a></h3>
<p>Working with Elm is a pretty large departure from every other framework we looked at. It’s a purely functional language, which means it provides certain guarantees that a JavaScript framework simply can’t. React uses functional patterns like immutability, but since JavaScript is not an immutable language you’re required to work harder to avoid breaking the code. Programming in React often comes with using libraries like Immutable.js for immutable types and Flow for static type checking, essentially bolting on language features onto JavaScript that it doesn’t naturally support. Using Elm makes the whole process much smoother to work with.</p>
<p>The downsides to Elm are the learning curve and dealing with the outside world. For the learning curve, Elm works hard to utilize difficult functional concepts in a way that’s easy to get started. The best way to learn Elm isn’t to try and master the language — it’s to start building apps and learn as you go. The other downside is dealing with the outside world — as we saw, something as simple as getting a timestamp was fairly involved to wire up in Elm. Working with HTTP requests, JSON responses, WYSIWYG editors — these all require a lot more work compared to quick and dirty (but dangerous) JavaScript approaches.</p>
<p>In the <a href="comparing-frontend-approaches-part-7-final-thoughts.html">last part</a> of this series, I’ll wrap up with some final thoughts about each frontend approach and how you might choose the right tool for the job. Stay tuned!</p>


<hr>
<ul class="post-navigation"><li>Next: <a href="/blog/comparing-frontend-approaches-part-7-final-thoughts.html">Comparing Frontend Approaches Part 7: Final Thoughts</a></li><li>Previous: <a href="/blog/comparing-frontend-approaches-part-5-react.html">Comparing Frontend Approaches Part 5: React</a></li>
  <li>Back to <a href="/blog/">all posts</a></li>
</ul>

    </main>

    <footer>
      <div>
        <img class="avatar" src="/img/avatar_square.jpg" alt="Profile picture of Peter Jang">
        <h4>Peter Jang</h4>
        <p>Hi! My name is Peter Jang, I'm an educator and software developer by trade (3rd Strike Ken main and amateur karaoke beast by hobby). I'm currently the Dean of Instruction at <a target="_blank" rel="noopener noreferrer me" href="https://actualize.co">Actualize</a>, where I design the web development curriculum and teach live classes at our Chicago main campus. This is my personal website where I write about programming and other technology-related topics.</p>
        <p>Follow me @peterxjang: <a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/peterxjang">twitter</a>, <a target="_blank" rel="noopener noreferrer me" href="https://github.com/peterxjang">github</a>, <a target="_blank" rel="noopener noreferrer me" href="https://linkedin.com/in/peterxjang">linkedin</a></p>
        <p>Subscribe to my blog: <a href="/feed/feed.xml">rss</a></p>
      </div>
    </footer>

    <!-- Current page: /blog/comparing-frontend-approaches-part-6-elm.html -->
  </body>
</html>
